# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB Atlas –Ω–∞ Railway

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ MongoDB Atlas –∫–ª–∞—Å—Ç–µ—Ä (5 –º–∏–Ω—É—Ç)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ MongoDB Atlas:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://www.mongodb.com/cloud/atlas
   - –í–æ–π–¥–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç

2. **–°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä:**
   - –ù–∞–∂–º–∏—Ç–µ **"Build a Database"** –∏–ª–∏ **"Create"**
   - –í—ã–±–µ—Ä–∏—Ç–µ **"M0 FREE"** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω (–±–ª–∏–∂–∞–π—à–∏–π –∫ Railway, –Ω–∞–ø—Ä–∏–º–µ—Ä: `AWS / us-east-1`)
   - –ù–∞–∂–º–∏—Ç–µ **"Create"**
   - –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-3 –º–∏–Ω—É—Ç—ã –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Network Access

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **"Network Access"**
2. –ù–∞–∂–º–∏—Ç–µ **"Add IP Address"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"Allow Access from Anywhere"** (`0.0.0.0/0`)
   - –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ IP Railway
4. –ù–∞–∂–º–∏—Ç–µ **"Confirm"**

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **"Database Access"**
2. –ù–∞–∂–º–∏—Ç–µ **"Add New Database User"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"Password"** –∫–∞–∫ –º–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. –í–≤–µ–¥–∏—Ç–µ:
   - **Username:** `plazma_bot` (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –∏–º—è)
   - **Password:** 
     - –ù–∞–∂–º–∏—Ç–µ **"Autogenerate Secure Password"** –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π
     - **–í–ê–ñ–ù–û:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å! –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è connection string
   - **Database User Privileges:** –í—ã–±–µ—Ä–∏—Ç–µ **"Atlas admin"** (–∏–ª–∏ **"Read and write to any database"**)
5. –ù–∞–∂–º–∏—Ç–µ **"Add User"**

### –®–∞–≥ 4: –ü–æ–ª—É—á–∏—Ç–µ connection string

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **"Database"**
2. –ù–∞–∂–º–∏—Ç–µ **"Connect"** –Ω–∞ –≤–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ
3. –í—ã–±–µ—Ä–∏—Ç–µ **"Connect your application"**
4. –í—ã–±–µ—Ä–∏—Ç–µ:
   - **Driver:** `Node.js`
   - **Version:** `5.5 or later`
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ connection string:
   ```
   mongodb+srv://plazma_bot:<password>@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```

### –®–∞–≥ 5: –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ connection string

1. –ó–∞–º–µ–Ω–∏—Ç–µ `<password>` –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å –∏–∑ —à–∞–≥–∞ 3
2. –î–æ–±–∞–≤—å—Ç–µ –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ `?`:
   ```
   mongodb+srv://plazma_bot:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/plazma_bot?retryWrites=true&w=majority
   ```

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å URL-encoded:
- `@` ‚Üí `%40`
- `#` ‚Üí `%23`
- `%` ‚Üí `%25`
- `&` ‚Üí `%26`
- `+` ‚Üí `%2B`
- `=` ‚Üí `%3D`

**–ü—Ä–∏–º–µ—Ä:**
- –ü–∞—Ä–æ–ª—å: `MyP@ss#123`
- URL-encoded: `MyP%40ss%23123`
- Connection string: `mongodb+srv://plazma_bot:MyP%40ss%23123@cluster0.xxxxx.mongodb.net/plazma_bot?retryWrites=true&w=majority`

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DATABASE_URL –Ω–∞ Railway

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://railway.app
   - –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
   - –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `plazma-production` (–∏–ª–∏ –≤–∞—à –ø—Ä–æ–µ–∫—Ç)

2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å–µ—Ä–≤–∏—Å –±–æ—Ç–∞:**
   - –ù–∞–π–¥–∏—Ç–µ —Å–µ—Ä–≤–∏—Å **plazma** (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –±–æ—Ç–∞)
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ

3. **–û—Ç–∫—Ä–æ–π—Ç–µ Variables:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"Settings"** ‚Üí **"Variables"**
   - –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Variables"**

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ DATABASE_URL:**
   - –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DATABASE_URL` (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ **"New Variable"** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π
   - **Key:** `DATABASE_URL`
   - **Value:** –í—Å—Ç–∞–≤—å—Ç–µ connection string –∏–∑ —à–∞–≥–∞ 5
   - –ù–∞–∂–º–∏—Ç–µ **"Save"** –∏–ª–∏ **"Add"**

### –®–∞–≥ 7: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å

1. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"Deployments"**
   - –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
   - –ù–∞–∂–º–∏—Ç–µ **"Redeploy"** (—Ç—Ä–∏ —Ç–æ—á–∫–∏ ‚Üí Redeploy)

### –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"Deployments"** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
2. –û—Ç–∫—Ä–æ–π—Ç–µ **"Deploy Logs"** –∏–ª–∏ **"HTTP Logs"**
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—è–≤–∏–ª–æ—Å—å:

**‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚ö†Ô∏è  MongoDB Atlas detected (consider switching to Railway MongoDB)
Database URL configured: mongodb+srv://...
Added default database name: plazma_bot
Database connected
‚úÖ Initial data ensured
```

**‚ùå –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- `SCRAM failure: Authentication failed`
- `Prisma needs to perform transactions, which requires your MongoDB server to be run as a replica set`
- `Invalid prisma.user.update() invocation`
- `ConnectorError`

### –®–∞–≥ 9: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ä–æ–π –±–∞–∑–µ:

1. **–ß–µ—Ä–µ–∑ Railway CLI:**
   ```bash
   railway link
   railway run npm run restore
   ```

2. **–ß–µ—Ä–µ–∑ Railway Dashboard:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Å–µ—Ä–≤–∏—Å ‚Üí **"Deployments"**
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `npm run restore`

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ `replica set`
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ `SCRAM failure`
   - –ï—Å—Ç—å `Database connected`

2. **–†–∞–±–æ—Ç–∞ –±–æ—Ç–∞:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
   - –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
   - –û—Ç–∫—Ä–æ–π—Ç–µ –æ—Ç–∑—ã–≤—ã - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∫—É - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –í MongoDB Atlas ‚Üí **"Database"** ‚Üí **"Browse Collections"**
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏: `User`, `Product`, `Category`, `Review`, `CartItem` –∏ —Ç.–¥.

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Authentication failed" –∏–ª–∏ "SCRAM failure"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ connection string
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–æ–ª—å URL-encoded (—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∑–∞–º–µ–Ω–µ–Ω—ã)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ `Atlas admin` –∏–ª–∏ `Read and write`

### –ü—Ä–æ–±–ª–µ–º–∞: "Network is unreachable" –∏–ª–∏ "Connection timeout"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network Access –≤ Atlas
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω IP `0.0.0.0/0` –∏–ª–∏ IP Railway
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è IP (–º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞)

### –ü—Ä–æ–±–ª–µ–º–∞: "Prisma needs to perform transactions, which requires your MongoDB server to be run as a replica set"

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ MongoDB Atlas (–Ω–µ Railway MongoDB)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ connection string –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `mongodb+srv://`)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω (—Å—Ç–∞—Ç—É—Å "Running" –≤ Atlas)

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ: `railway run npm run restore`
2. –ò–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Prisma: `railway run npx prisma db push`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [MongoDB Atlas Documentation](https://docs.atlas.mongodb.com/)
- [Prisma MongoDB Setup](https://www.prisma.io/docs/concepts/database-connectors/mongodb)
- [Railway Environment Variables](https://docs.railway.app/develop/variables)

## üí° –°–æ–≤–µ—Ç—ã

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
   - –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ connection string –≤ git

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –í Atlas Dashboard –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
   - –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier (M0) –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤

3. **–ë—ç–∫–∞–ø—ã:**
   - Atlas –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø—ã (–¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤)
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `npm run restore` –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ Cloudinary
