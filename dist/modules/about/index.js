import { Markup } from 'telegraf';
import { logUserAction } from '../../services/user-history.js';
import { getBotContent } from '../../services/bot-content-service.js';
// Fallback —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î
const fallbackAboutText = `üíß <b>–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–ª–∞–∑–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–æ–¥–∞?</b>

‚ö°Ô∏è <b>–ñ–∏–¥–∫–∏–µ –≤–∏—Ç–∞–º–∏–Ω—ã –∏ –º–∏–Ω–µ—Ä–∞–ª—ã –≤ –Ω–∞–Ω–æ—Ñ–æ—Ä–º–µ</b>

‚ú® Plazma Water ‚Äî —ç—Ç–æ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –≤–æ–¥–Ω—ã–π —Ä–∞—Å—Ç–≤–æ—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –º–∏–∫—Ä–æ—ç–ª–µ–º–µ–Ω—Ç—ã –≤ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ø–ª–∞–∑–º–µ–Ω–Ω–æ–π –Ω–∞–Ω–æ—Å—Ç—Ä—É–∫—Ç—É—Ä–µ. –ë–ª–∞–≥–æ–¥–∞—Ä—è –æ—Å–æ–±–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —á–∞—Å—Ç–∏—Ü—ã –≤ —Å–æ—Å—Ç–∞–≤–µ –∏–º–µ—é—Ç –Ω–∞–Ω–æ —Ä–∞–∑–º–µ—Ä –∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –≤–æ–¥–µ, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏—Ö –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞.

üß¨ –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º –¥–æ–±–∞–≤–æ–∫, –≥–¥–µ —É—Å–≤–æ–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ, –ø–ª–∞–∑–º–µ–Ω–Ω–∞—è –Ω–∞–Ω–æ—Ñ–æ—Ä–º–∞ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –±–æ–ª–µ–µ –º—è–≥–∫–æ–º—É –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É –≤–∫–ª—é—á–µ–Ω–∏—é –º–∏–∫—Ä–æ—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –æ–±–º–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã. –ü—Ä–∏ —ç—Ç–æ–º –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—á–∞—Å—Ç–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç –ª—ë–≥–∫–∏–º –¥–ª—è –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –ø—Ä–∏ —Ä–∞–∑—É–º–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

‚ö†Ô∏è Plazma Water –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–æ–º –∏ –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ª–µ—á–µ–Ω–∏—è –∏–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π. –ï–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ–¥–Ω–æ-–º–∏–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞, –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–º—Ñ–æ—Ä—Ç–∞, —ç–Ω–µ—Ä–≥–∏–∏ –∏ –æ–±—â–µ–≥–æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è.

üî¨ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ø–ª–∞–∑–º–µ–Ω–Ω–æ–π –Ω–∞–Ω–æ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ –≤–æ–¥—ã –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–∞–≥–Ω–∏—Ç–Ω–æ-–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π, –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ñ–∏–∑–∏–∫–µ –ø–ª–∞–∑–º—ã. –¢–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ä–µ–¥—ã –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –∏ –º–æ–∂–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞—â–∏—Ç–Ω—ã–µ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.`;
export const aboutModule = {
    async register(bot) {
        // Handle about command
        bot.command('about', async (ctx) => {
            try {
                await logUserAction(ctx, 'command:about');
                await showAbout(ctx);
            }
            catch (error) {
                console.error('‚ÑπÔ∏è About: Failed to process /about command', error);
                await ctx.reply('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        });
        bot.hears(['‚ÑπÔ∏è –û PLAZMA'], async (ctx) => {
            try {
                await logUserAction(ctx, 'menu:about');
                await showAbout(ctx);
            }
            catch (error) {
                console.error('‚ÑπÔ∏è About: Failed to process about menu', error);
                await ctx.reply('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        });
    },
};
export async function showAbout(ctx) {
    try {
        const aboutText = (await getBotContent('about_text')) || fallbackAboutText;
        const keyboard = Markup.inlineKeyboard([
            [
                Markup.button.url('üì± VK', 'https://vk.com/iplazma'),
                Markup.button.url('üì∏ Instagram', 'https://www.instagram.com/iplazmanano/')
            ],
            [
                Markup.button.url('üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞', 'https://t.me/diglukhov?text=–ó–¥—Ä–∞—Å–≤—É–π—Ç–µ —É –º–µ–Ω—è –≤–æ–ø—Ä–æ—Å –ø–æ PLAZMA')
            ],
            [
                Markup.button.url('üåê –ö–∞—Ç–∞–ª–æ–≥', 'https://iplazma.tilda.ws/'),
                Markup.button.url('üí¨ Telegram', 'https://t.me/iplazmabot')
            ]
        ]);
        await ctx.reply(aboutText, { ...keyboard, parse_mode: 'HTML' });
    }
    catch (error) {
        console.error('‚ÑπÔ∏è About: Failed to load about content', error);
        await ctx.reply(fallbackAboutText, { parse_mode: 'HTML' });
    }
}
