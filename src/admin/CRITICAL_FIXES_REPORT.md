# Критические исправления синтаксических ошибок

## Проблема
Синтаксические ошибки на строках 631 и 3884 в сгенерированном HTML:
- `Uncaught SyntaxError: Invalid or unexpected token (at products:631:23)`
- `Uncaught SyntaxError: Invalid or unexpected token (at products:3884:23)`

## Исправления

### 1. Улучшена функция `escapeAttr`
- Добавлена обработка обратных слешей (`\\`)
- Добавлено удаление line separator (`\u2028`) и paragraph separator (`\u2029`)
- Улучшена обработка управляющих символов

### 2. Удалены все inline обработчики событий
- **Удален `onchange`** из input загрузки изображений → заменен на event delegation
- **Удален `onerror`** из img тегов → заменен на event delegation через `data-onerror-*` атрибуты
- **Удален `onsubmit`** из форм удаления → заменен на event delegation

### 3. Добавлена полная event delegation
- Обработка форм удаления товаров
- Обработка загрузки изображений через файловый input
- Обработка ошибок загрузки изображений
- Все обработчики используют безопасное экранирование данных

### 4. Улучшена обработка данных инструкции
- Дополнительная очистка данных перед вставкой в `data-instruction-text`
- Удаление всех проблемных символов (переносы строк, управляющие символы)
- Безопасное отображение в alert

### 5. Исправлена обработка ошибок изображений
- Изображения с ошибками обрабатываются через event delegation
- Использование `data-onerror-*` атрибутов вместо inline `onerror`

## Файлы изменены
- `vital/src/admin/web.ts`

## Ожидаемый результат
После деплоя:
- ✅ Нет синтаксических ошибок в консоли
- ✅ Все кнопки работают корректно
- ✅ Нет проблем с экранированием данных
- ✅ Безопасная обработка всех пользовательских данных

## Дата исправления
2024-12-19

