# Инструкция по применению миграции базы данных

## Обновление схемы базы данных

Были добавлены следующие изменения в схему Prisma:

1. **Модель Product** - добавлены поля:
   - `purchasePrice` (Float?) - закупочная цена в БАТ
   - `sku` (String?) - код товара (артикул)
   - `lowStockThreshold` (Int) - порог низкого остатка (по умолчанию 3)

2. **Модель Settings** - новая модель для хранения настроек:
   - `key` (String, unique) - ключ настройки
   - `value` (String) - значение настройки (JSON)
   - `description` (String?) - описание настройки

## Способы применения миграции:

### Вариант 1: Через Railway CLI (рекомендуется)

```bash
# 1. Войдите в Railway
railway login

# 2. Перейдите в проект
railway link

# 3. Примените изменения схемы
railway run npx prisma db push
```

### Вариант 2: Через Railway Web UI

1. Откройте проект в Railway: https://railway.app
2. Перейдите в раздел "Variables"
3. Убедитесь, что `DATABASE_URL` настроен
4. Откройте раздел "Deployments" или "Settings"
5. Используйте Railway Shell или создайте временную команду

### Вариант 3: Локально (если настроен .env)

```bash
cd vital
npx prisma db push
```

## Проверка после миграции

После применения миграции проверьте:

1. Что модель Settings создана в базе данных
2. Что поля `purchasePrice`, `sku`, `lowStockThreshold` добавлены в модель Product
3. Попробуйте создать/обновить товар через админку

## Примечание

MongoDB не требует миграций в классическом смысле (как SQL базы), поэтому `prisma db push` просто синхронизирует схему с базой данных напрямую.



