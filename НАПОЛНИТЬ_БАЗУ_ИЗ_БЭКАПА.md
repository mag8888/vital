# Наполнить базу PLAZMA из бэкапа

Чтобы каталог в мини-приложении перестал быть пустым («Каталог пока пуст», «Товары временно недоступны»), восстановите данные из бэкапа.

## Полное восстановление из другой MongoDB (свежие данные)

Если «свежие» данные лежат в другой MongoDB (например, другой инстанс Railway), можно скопировать оттуда в текущую БД одной командой:

```bash
# SOURCE_MONGO_URL — откуда брать данные (источник с каталогом)
# DATABASE_URL или MONGO_URL — куда восстанавливать (текущая БД приложения, из .env)
SOURCE_MONGO_URL="mongodb://user:pass@host:port/ИМЯ_БД" node scripts/sync-from-mongodb.js
```

Или передать URL первым аргументом:

```bash
node scripts/sync-from-mongodb.js "mongodb://mongo:пароль@crossover.proxy.rlwy.net:50105/plazma"
```

Скрипт экспортирует из источника категории, товары, пользователей, заказы, отзывы, партнёров и т.д., сохраняет во временный файл и запускает восстановление в БД из `DATABASE_URL`/`MONGO_URL`. Если в URL источника нет имени базы (после порта), по умолчанию используется база `test`; при необходимости укажите имя, например: `.../50105/plazma`.

## Вариант 1: Локальный файл бэкапа

Если в проекте уже есть файл бэкапа (например `database-backup-2025-12-07T17-30-20.json`):

```bash
# Из корня проекта, с указанием DATABASE_URL или MONGO_URL в .env
node scripts/restore-from-cloudinary.js "./database-backup-2025-12-07T17-30-20.json"
```

или через npm:

```bash
npm run restore -- "./database-backup-2025-12-07T17-30-20.json"
```

## Вариант 2: Последний бэкап из Cloudinary

Если бэкапы залиты в Cloudinary (папка `plazma-bot/backups`), в `.env` должны быть заданы `CLOUDINARY_CLOUD_NAME`, `CLOUDINARY_API_KEY`, `CLOUDINARY_API_SECRET`. Тогда:

```bash
npm run restore
```

Скрипт сам возьмёт последний бэкап из Cloudinary и восстановит базу.

## Вариант 3: Railway (продакшен)

На Railway с подключённой БД и переменными окружения:

```bash
railway run npm run restore
```

Или с локальным файлом (если файл загружен на Railway или доступен по URL):

```bash
railway run node scripts/restore-from-cloudinary.js "https://res.cloudinary.com/.../plazma-bot/backups/database-backup-....json"
```

## После восстановления

- Перезапустите приложение (или дождитесь перезапуска на Railway).
- Обновите мини-приложение в Telegram — каталог должен отобразить товары и категории из бэкапа.

## Проверка локальных бэкапов

```bash
ls -la database-backup-*.json
node scripts/list-cloudinary-backups.js   # список в Cloudinary
```
