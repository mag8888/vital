<!-- Bank Module v4 - Clean and Simple Interface -->
<div id="bankModal" class="bank-modal" style="display: none;">
    <div class="bank-modal-content">
        <!-- Header -->
        <div class="bank-modal-header">
            <div class="bank-header-left">
                <div class="bank-icon">üè¶</div>
                <h2 class="bank-modal-title">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ <span style="color: #ff6b6b; font-size: 12px; font-weight: normal;">[v4-DEBUG]</span></h2>
            </div>
            <button class="bank-modal-close" onclick="closeBankV4()">&times;</button>
        </div>
        
        <!-- Main Content -->
        <div class="bank-modal-body">
            <!-- Left Column - Financial Summary -->
            <div class="bank-info-column">
                <!-- Bank Status -->
                <div class="bank-status-section">
                    <div class="bank-status-header">
                        <div class="bank-icon-small">üè¶</div>
                        <span class="bank-status-label">–ë–∞–Ω–∫</span>
                        <span class="bank-status-badge active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                    </div>
                </div>
                
                <!-- Current Balance -->
                <div class="balance-section">
                    <div class="current-balance" id="currentBalance">$0</div>
                    <div class="balance-label">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                </div>
                
                <!-- Financial Summary -->
                <div class="financial-summary">
                    <div class="summary-item income">
                        <div class="summary-icon">üìà</div>
                        <span class="summary-label">–î–æ—Ö–æ–¥:</span>
                        <span class="summary-value" id="totalIncome">$0</span>
                    </div>
                    <div class="summary-item expenses">
                        <div class="summary-icon">üìâ</div>
                        <span class="summary-label">–†–∞—Å—Ö–æ–¥—ã:</span>
                        <span class="summary-value" id="totalExpenses">$0</span>
                    </div>
                    <div class="summary-item payday">
                        <div class="summary-icon">üí∞</div>
                        <span class="summary-label">PAYDAY:</span>
                        <span class="summary-value" id="monthlyIncome">$0/–º–µ—Å</span>
                    </div>
                </div>
                
                <!-- Credit Section -->
                <div class="credit-section">
                    <div class="credit-info">
                        <div class="credit-item">
                            <div class="credit-icon">üìÑ</div>
                            <span class="credit-label">–ö—Ä–µ–¥–∏—Ç:</span>
                            <span class="credit-value" id="currentCredit">$0</span>
                        </div>
                        <div class="credit-item">
                            <span class="credit-label">–ú–∞–∫—Å. –∫—Ä–µ–¥–∏—Ç:</span>
                            <span class="credit-value" id="maxCredit">$0</span>
                        </div>
                    </div>
                    <div class="credit-buttons">
                        <button class="credit-btn payoff" onclick="payoffCreditV4()" id="payoffBtn">
                            ‚úì –ü–û–ì–ê–°–ò–¢–¨
                        </button>
                        <button class="credit-btn take" onclick="requestCreditV4(1000)" id="takeCreditBtn">
                            üìÑ –í–ó–Ø–¢–¨
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Operations -->
            <div class="operations-column">
                <!-- Transfer Form -->
                <div class="transfer-section">
                    <h3 class="section-title">–ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
                    <form id="transferForm" class="transfer-form" onsubmit="event.preventDefault(); processTransferV4();">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recipientSelect" class="form-label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
                                <select id="recipientSelect" class="form-select">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="transferAmount" class="form-label">–°—É–º–º–∞ ($)</label>
                                <div class="amount-input-wrapper">
                                    <div class="amount-icon">üí∞</div>
                                    <input type="number" id="transferAmount" class="form-input amount-input" placeholder="0" min="1">
                                </div>
                            </div>
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="transfer-btn primary">‚úàÔ∏è –í–´–ü–û–õ–ù–ò–¢–¨ –ü–ï–†–ï–í–û–î</button>
                            <button type="button" class="transfer-btn secondary" onclick="resetTransferFormV4()">–°–ë–†–û–°–ò–¢–¨</button>
                        </div>
                    </form>
                </div>
                
                <!-- Operations History -->
                <div class="history-section">
                    <div class="section-header">
                        <h3 class="section-title">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                        <div class="history-badge">
                            <div class="history-icon">üïê</div>
                            <span class="history-count" id="historyCount">0</span>
                        </div>
                    </div>
                    <div class="transfers-history" id="transfersHistory">
                        <!-- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–æ–π –ø–µ—Ä–µ–≤–æ–¥–∞
function processTransferV4() {
    const recipientSelect = document.getElementById('recipientSelect');
    const amountInput = document.getElementById('transferAmount');
    
    const recipientIndex = parseInt(recipientSelect.value);
    const amount = parseInt(amountInput.value);
    
    if (!recipientIndex || !amount) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –∏ —É–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É');
        return;
    }
    
    transferMoneyV4(recipientIndex, amount).then(success => {
        if (success) {
            resetTransferFormV4();
            alert('–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
        }
    });
}

function resetTransferFormV4() {
    // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ —Å—É–º–º—É, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è
    document.getElementById('transferAmount').value = '';
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
function initRecipientsList() {
    const select = document.getElementById('recipientSelect');
    const players = window.players || [];
    const currentUserId = bankModuleV4?.userId;
    const currentPlayerName = bankModuleV4?.playerName;
    
    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</option>';
    
    players.forEach((player, index) => {
        const playerId = player.user_id || player.userId;
        const playerName = player.name || player.username || `–ò–≥—Ä–æ–∫ ${index + 1}`;

        const isSameById = currentUserId && playerId && String(playerId) === String(currentUserId);
        const isSameByName = currentPlayerName && playerName === currentPlayerName;

        if (isSameById || isSameByName) {
            return;
        }

        const option = document.createElement('option');
        option.value = index;
        option.textContent = playerName;
        select.appendChild(option);
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
function updateHistoryCount() {
    const count = document.getElementById('transfersHistory').children.length;
    const countEl = document.getElementById('historyCount');
    if (countEl) {
        countEl.textContent = count;
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
document.addEventListener('DOMContentLoaded', () => {
    initRecipientsList();
});
</script>
