# MongoDB Atlas: Настройка подключения

## Ваши учетные данные

✅ **Пользователь**: `smirenskaya5984_db_user`  
✅ **Пароль**: `nwYsMppKRXCdqURM`

## Шаг 1: Получить адрес кластера

1. Откройте https://cloud.mongodb.com/
2. Войдите в аккаунт
3. Выберите ваш кластер
4. Нажмите кнопку **"Connect"**
5. Выберите **"Connect your application"**
6. Скопируйте строку подключения (примерно такую):
   ```
   mongodb+srv://<username>:<password>@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```

## Шаг 2: Сформировать полную строку подключения

В скопированной строке:
1. Замените `<username>` на: `smirenskaya5984_db_user`
2. Замените `<password>` на: `nwYsMppKRXCdqURM`
3. **Важно**: Добавьте `/vital` перед `?` (это имя базы данных)

**Пример итоговой строки:**
```
mongodb+srv://smirenskaya5984_db_user:nwYsMppKRXCdqURM@cluster0.xxxxx.mongodb.net/vital?retryWrites=true&w=majority
```

⚠️ **Замените `cluster0.xxxxx.mongodb.net` на реальный адрес из вашего Atlas!**

## Шаг 3: Обновить DATABASE_URL в Railway

1. Откройте https://railway.app/
2. Выберите ваш проект
3. Выберите сервис (vital-bot)
4. Перейдите в **"Variables"**
5. Найдите `DATABASE_URL`
6. Замените значение на строку из шага 2
7. Railway автоматически перезапустит сервис

## Шаг 4: Применить индексы

После перезапуска нужно применить индексы в Prisma. Railway сделает это автоматически при деплое, или можно сделать вручную:

1. В Railway откройте ваш сервис
2. Перейдите в **"Settings"** → **"Deploy"**
3. В разделе **"Build Command"** добавьте:
   ```bash
   npm install && npx prisma generate && npx prisma db push
   ```

Или при следующем деплое индексы применятся автоматически через `postinstall` скрипт.

## Шаг 5: Проверить работу

После обновления `DATABASE_URL` проверьте логи Railway:
- ✅ Должны исчезнуть ошибки "replica set"
- ✅ Должно появиться сообщение "Database URL configured"
- ✅ Приложение должно работать без ошибок

---

## Быстрый чек-лист

- [ ] Получен адрес кластера из Atlas (cluster0.xxxxx.mongodb.net)
- [ ] Сформирована строка подключения с учетными данными
- [ ] Добавлено `/vital` перед `?` в строке подключения
- [ ] Обновлена переменная `DATABASE_URL` в Railway
- [ ] Проверены логи после перезапуска

---

## Если что-то не работает

### Ошибка аутентификации
- Проверьте, что username и password правильно скопированы
- Убедитесь, что в пароле нет лишних пробелов
- Проверьте, что пользователь имеет права на базу данных

### Ошибка подключения
- Убедитесь, что в Network Access разрешен доступ с любого IP (0.0.0.0/0)
- Проверьте, что кластер запущен (не в режиме паузы)

### База данных не создается
- База `vital` создастся автоматически при первом подключении
- Если не создается, проверьте права пользователя в Atlas

